{% extends 'base.html' %}
{% block content %}
<h2>Actualizar Pedido #{{ contrato.id }}</h2>
<form method="post" class="card p-4">
    {% csrf_token %}
    
    <div class="mb-3">
        <label>Cliente</label>
        <select name="cliente" class="form-select" required>
            {% for c in clientes %}
            <option value="{{ c.id }}" {% if c.id == contrato.cliente.id %}selected{% endif %}>
                {{ c.nombre }} {{ c.apellido }}
            </option>
            {% endfor %}
        </select>
    </div>

    <div class="mb-3">
        <label>Servicio</label>
        <select name="servicio" class="form-select" required>
            {% for s in servicios %}
            <option value="{{ s.id }}" {% if s.id == contrato.servicio.id %}selected{% endif %}>
                {{ s.nombre_servicio }} (${{ s.precio }})
            </option>
            {% endfor %}
        </select>
    </div>

    <div class="mb-3">
        <label>Empleados Asignados (Ctrl + Click para seleccionar varios)</label>
        <select name="empleados" class="form-select" multiple size="4">
            {% for e in empleados %}
            <option value="{{ e.id }}" {% if e.id in empleados_seleccionados_ids %}selected{% endif %}>
                {{ e.nombre }} {{ e.apellido }}
            </option>
            {% endfor %}
        </select>
    </div>

    <div class="mb-3">
        <label>Fecha Programada</label>
        <input type="date" name="fecha_programada" value="{{ contrato.fecha_programada|date:'Y-m-d' }}" class="form-control" required>
    </div>

    <div class="mb-3">
        <label>Estado</label>
        <select name="estado" class="form-select">
            <option value="PENDIENTE" {% if contrato.estado == 'PENDIENTE' %}selected{% endif %}>Pendiente</option>
            <option value="EN_PROGRESO" {% if contrato.estado == 'EN_PROGRESO' %}selected{% endif %}>En Progreso</option>
            <option value="COMPLETADO" {% if contrato.estado == 'COMPLETADO' %}selected{% endif %}>Completado</option>
            <option value="CANCELADO" {% if contrato.estado == 'CANCELADO' %}selected{% endif %}>Cancelado</option>
        </select>
    </div>

    <div class="mb-3">
        <label>Observaciones</label>
        <textarea name="observaciones" class="form-control">{{ contrato.observaciones }}</textarea>
    </div>

    <div class="mb-3">
        <label>Costo Total (Opcional, sobrescribe el del servicio)</label>
        <input type="number" step="0.01" name="costo_total" value="{{ contrato.costo_total|stringformat:'f' }}" class="form-control">
    </div>

    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
    <a href="{% url 'ver_contratos' %}" class="btn btn-secondary">Cancelar</a>
</form>
{% endblock %}